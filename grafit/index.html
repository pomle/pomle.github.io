<html class="classic"><head> <title>grafit</title> <meta property="og:title" content="grafit - draw graphs with javascript"/> <meta property="og:description" content="No bullshit. Just JavaScript functions turned into shapes."/> <meta property="og:image" content="http://i.imgur.com/jCmtJsz.png"/> <style type="text/css">#graph .zoom,#graph input{opacity:.2;position:absolute}body{margin:0}.interface{display:flex;height:100%}#functions{border-right:solid 1px rgba(0,0,0,.2);flex:0 0 auto}#functions button{background:#00adee;border:none;border-radius:.3em;color:#fff;padding:.3em .5em;margin:.4em .5em}#functions select{margin:.4em .5em}#functions textarea{border-style:solid;border-width:1px 0 0 6px;display:block;font-family:monospace;height:5em;width:20em}#functions textarea.error{background-color:rgba(255,0,0,.2)!important}#graph{flex:1 1 auto;position:relative;user-select:none}#graph .zoom{background-color:#98d5ec;border:1px dashed #1e9dcc;pointer-events:none;height:100px;width:100px;visibility:hidden}#graph .zoom.active{visibility:visible}#graph canvas{height:100%;width:100%}#graph input{background-color:transparent;border-radius:.5em;border:0;font-family:monospace;margin:.2em;padding:.3em;text-align:center;width:10em}#graph:hover input{background-color:rgba(255,255,255,.8);opacity:1}#graph input[name=x1]{left:0;top:50%;text-align:left}#graph input[name=x2]{top:50%;right:0;text-align:right}#graph input[name=y1]{left:50%;top:0;text-align:left}#graph input[name=y2]{bottom:0;left:50%;text-align:left}.dark body{background-color:#191919}.dark #functions textarea{background-color:#191919;color:#0f0}.dark #graph input{color:#fff}.dark #graph:hover input{background-color:rgba(0,0,0,.8)}</style></head><body> <div class="interface"> <section id="functions"> <div class="inputs"> </div><button name="createInput">Add Function</button><br/> <button name="resetZoom">Reset Zoom</button><br/> <select name="theme"> <option value="classic">Paper</option> <option value="dark">Coal</option> </select> </section> <section id="graph"> <div class="inputs"> <input type="text" name="x1" value="-10"/> <input type="text" name="x2" value="10"/> <input type="text" name="y1" value="10"/> <input type="text" name="y2" value="-10"/> </div><div class="zoom"></div><canvas id="canvas"/> </section> </div><script type="text/javascript">function canvasPoint(t){var e=(t.x+-viewport[0].x)/scale.x,o=(t.y+-viewport[0].y)/scale.y,n=-1,a=canvas.height+1;return n>o?o=n:o>a&&(o=a),{x:e,y:o}}function viewportPoint(t){return{x:t.x*scale.x+viewport[0].x,y:t.y*scale.y+viewport[0].y}}function createInput(){void 0===colors.counter&&(colors.counter=0);var t=document.createElement("textarea"),e=colors[colors.counter++%colors.length];return t.style.borderColor=e,funcInputs.appendChild(t),t}function detectGraphSizeChange(){var t=canvas.getBoundingClientRect();(canvas.lastW!==t.width||canvas.lastH!==t.height)&&updateCanvasSize()}function drawAll(){context.clearRect(0,0,canvas.width,canvas.height),drawGrid();for(var t=0,e=functions.length;t!==e;++t)functions[t]&&drawFunction(functions[t])}function drawFunction(t){var e=[],o=Math.min(viewport[0].x,viewport[1].x),n=Math.max(viewport[0].x,viewport[1].x),a=n-o,r=a/canvas.width,c=o;if(0===a)return void console.error("Viewport zero size");for(;n>=c;)e.push({x:c,y:t(c)}),c+=r;context.beginPath();var i=canvasPoint(e[0]);context.moveTo(i.x,i.y);for(var s=1,u=e.length;s!==u;++s)i=canvasPoint(e[s]),context.lineTo(i.x,i.y);context.strokeStyle=t.color,context.stroke(),context.closePath()}function drawGrid(){var t;context.beginPath(),t=canvasPoint({x:viewport[0].x,y:0}),context.moveTo(t.x,t.y),t=canvasPoint({x:viewport[1].x,y:0}),context.lineTo(t.x,t.y),t=canvasPoint({x:0,y:viewport[0].y}),context.moveTo(t.x,t.y),t=canvasPoint({x:0,y:viewport[1].y}),context.lineTo(t.x,t.y),context.strokeStyle="#1e9dcc",context.stroke(),context.closePath()}function fetchFunctions(){try{var t=localStorage.getItem("functions"),e=JSON.parse(t)}catch(o){console.error(o)}Array.isArray(e)&&0!==e.length||(e=[{func:"function (x){\n return Math.sin(x) * 2;\n}\n",color:colors[0]}]);for(var n=0,a=e.length;n!==a;++n){var r=createInput();r.value=e[n].func,r.style.borderColor=e[n].color,parseTextarea(r)}}function parseFunction(text){for(var wrappers=[{head:"func=",tail:""},{head:"func=function(x){",tail:";}"}],evaluate,func,error,i=0,l=wrappers.length;i!==l;++i){evaluate=wrappers[i].head+text+wrappers[i].tail;try{if(eval(evaluate),"function"==typeof func){if(!isFinite(func(1)))throw new Error("Invalid return value");return func}}catch(e){error=e}}throw error}function parseTextarea(t){var e=t.value.trim();if(t.classList.remove("error"),0===e.length)return!1;try{return func=parseFunction(e),func.color=t.style.borderColor,func}catch(o){console.error(o),t.classList.add("error")}return func}function readViewportSize(){var t={};[].forEach.call(graphInputs.querySelectorAll("input"),function(e){t[e.name]=parseFloat(e.value)}),viewport=[{x:t.x1,y:t.y1},{x:t.x2,y:t.y2}],viewport.w=viewport[1].x-viewport[0].x,viewport.h=viewport[1].y-viewport[0].y,updateViewportMeta()}function storeFunctions(){var t=[];[].forEach.call(funcInputs.querySelectorAll("textarea"),function(e){0!==e.value.trim().length&&t.push({func:e.value,color:e.style.borderColor})}),localStorage.setItem("functions",JSON.stringify(t))}function updateCanvasSize(){var t=canvas.getBoundingClientRect();canvas.width=t.width,canvas.height=t.height,canvas.lastW=t.width,canvas.lastH=t.height,updateViewportMeta(),drawAll()}function updateFunctions(){functions=[],[].forEach.call(funcInputs.querySelectorAll("textarea"),function(t){var e=parseTextarea(t);e!==!1&&functions.push(e)}),drawAll()}function updateViewportMeta(){offset={x:viewport[0].x-viewport.w,y:viewport[0].y-viewport.h},scale={x:viewport.w/canvas.width,y:viewport.h/canvas.height}}function drawZoomRect(t,e,o,n){console.log(arguments);var a=Math.abs(t-o),r=Math.abs(e-n),c=Math.min(t,o),i=Math.min(e,n);zoomRect.style.left=c+"px",zoomRect.style.top=i+"px",zoomRect.style.width=a+"px",zoomRect.style.height=r+"px"}function updateViewportSize(t,e,o,n){var a={x1:t,x2:o,y1:e,y2:n};[].forEach.call(graphInputs.querySelectorAll("input"),function(t){t.value=a[t.name]}),readViewportSize(),drawAll()}var canvas=document.getElementById("canvas"),context=canvas.getContext("2d"),functions=[],graphInputs=document.querySelector("#graph .inputs"),funcInputs=document.querySelector("#functions .inputs"),zoomRect=document.querySelector("#graph .zoom"),viewport,scale,offset,colors=["#00adee","#ec038a","#662d8f","#8bc543","#f69322","#ed1d24","#0054a4","#007137","#ed1659"];setInterval(detectGraphSizeChange,2e3),funcInputs.addEventListener("change",function(t){"TEXTAREA"===t.target.tagName?storeFunctions():"theme"===t.target.name&&console.log(t.target)}),funcInputs.addEventListener("keyup",function(t){updateFunctions()}),function(){var t=document.querySelector("select[name=theme]");t.addEventListener("change",function(t){var e=t.target,o=document.querySelector("html");[].forEach.call(e,function(t){o.classList.remove(t.value)}),o.classList.add(e.value),localStorage.setItem("theme",e.value)});var e=localStorage.getItem("theme");e&&(t.value=e,t.dispatchEvent(new Event("change")))}(),document.addEventListener("click",function(t){"createInput"===t.target.name?createInput():"resetZoom"===t.target.name&&updateViewportSize(-10,10,10,-10)}),document.addEventListener("mousedown",function(t){if("canvas"===t.target.id&&1===t.buttons){t.target;zoomRect.start={x:t.layerX,y:t.layerY},zoomRect.classList.add("active"),drawZoomRect(zoomRect.start.x,zoomRect.start.y,zoomRect.start.x,zoomRect.start.y)}}),document.addEventListener("mousemove",function(t){zoomRect.classList.contains("active")&&drawZoomRect(zoomRect.start.x,zoomRect.start.y,t.layerX,t.layerY)}),document.addEventListener("mouseup",function(t){if(zoomRect.classList.contains("active")){zoomRect.classList.remove("active");var e=Math.min(zoomRect.start.x,t.layerX),o=Math.max(zoomRect.start.x,t.layerX),n=Math.min(zoomRect.start.y,t.layerY),a=Math.max(zoomRect.start.y,t.layerY);if(e===o||n===a)return;var r=viewportPoint({x:e,y:n}),c=viewportPoint({x:o,y:a});updateViewportSize(r.x,r.y,c.x,c.y)}}),graphInputs.addEventListener("change",function(t){readViewportSize(),drawAll()}),fetchFunctions(),readViewportSize(),updateCanvasSize(),updateFunctions(),drawAll();</script></body></html>
