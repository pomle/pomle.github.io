<html><head> <title>grafit</title> <style type="text/css">body{margin:0}.interface{display:flex}#functions{border-right:solid 1px rgba(0,0,0,.2);flex:0 0}#functions textarea{display:block;font-family:monospace;height:5em;width:20em}#functions textarea.error{background-color:rgba(255,0,0,.2)}#graph{flex-grow:1;position:relative}#graph canvas{height:100%;width:100%}#graph input{background-color:rgba(255,255,255,.5);border:0;font-family:monospace;height:2em;opacity:.2;position:absolute;text-align:center;width:4em}#graph:hover input{opacity:1}#graph input[name=x1]{left:0;top:2.5em}#graph input[name=x2]{bottom:2.5em;right:0}#graph input[name=y1]{left:4.5em;top:0}#graph input[name=y2]{bottom:0;right:4.5em}</style></head><body> <div class="interface"> <section id="functions"> <div class="inputs"> </div><button name="createInput">+</button> </section> <section id="graph"> <div class="inputs"> <input type="text" name="x1" value="-100"/> <input type="text" name="x2" value="100"/> <input type="text" name="y1" value="-100"/> <input type="text" name="y2" value="100"/> </div><canvas id="canvas"/> </section> </div><script>function canvasPoint(a){return{x:(a.x+-viewport[0].x)/scale.x,y:(a.y+-viewport[0].y)/scale.y}}function createInput(){void 0===colors.counter&&(colors.counter=0);var a=document.createElement("textarea"),b=colors[colors.counter++%colors.length];return a.style.borderColor=b,funcInputs.appendChild(a),a}function detectGraphSizeChange(){var a=canvas.getBoundingClientRect();(canvas.width!==a.width||canvas.height!==a.height)&&updateCanvasSize()}function drawAll(){context.clearRect(0,0,canvas.width,canvas.height),drawGrid();for(var a=0,b=functions.length;a!==b;++a)functions[a]&&drawFunction(functions[a])}function drawFunction(a){for(var b=[],c=viewport[0].x;c<=viewport[1].x;)b.push({x:c,y:a(c)}),c+=scale.x;context.beginPath();var d=canvasPoint(b[0]);context.moveTo(d.x,d.y);for(var e=1,f=b.length;f>e;++e){var d=canvasPoint(b[e]);context.lineTo(d.x,d.y)}context.strokeStyle=a.color,context.stroke(),context.closePath()}function drawGrid(){var a;context.beginPath(),a=canvasPoint({x:viewport[0].x,y:0}),context.moveTo(a.x,a.y),a=canvasPoint({x:viewport[1].x,y:0}),context.lineTo(a.x,a.y),a=canvasPoint({x:0,y:viewport[0].y}),context.moveTo(a.x,a.y),a=canvasPoint({x:0,y:viewport[1].y}),context.lineTo(a.x,a.y),context.strokeStyle="#1e9dcc",context.stroke(),context.closePath()}function fetchFunctions(){try{var a=localStorage.getItem("functions"),b=JSON.parse(a)}catch(c){console.error(c)}Array.isArray(b)&&0!==b.length||(b=[{func:"function (x){\n return Math.sin(x/10) * 20;\n}\n",color:colors[0]}]);for(var d=0,e=b.length;d!==e;++d){var f=createInput();f.value=b[d].func,f.style.borderColor=b[d].color,handleFunctionInput(f)}}function handleFunctionInput(a){var b=a.value.trim();if(a.classList.remove("error"),0===b.length)return!1;try{return func=parseFunction(b),func.color=a.style.borderColor,func}catch(c){a.classList.add("error")}return func}function parseFunction(text){for(var wrappers=[{head:"func=",tail:""},{head:"func=function(x){",tail:";}"}],evaluate,func,i=0,l=wrappers.length;i!==l;++i){evaluate=wrappers[i].head+text+wrappers[i].tail;try{if(eval(evaluate),"function"==typeof func)return func}catch(error){}}throw error}function readViewportSize(){var a={};[].forEach.call(graphInputs.querySelectorAll("input"),function(b){a[b.name]=parseFloat(b.value)}),viewport=[{x:a.x1,y:a.y1},{x:a.x2,y:a.y2}],viewport.w=viewport[1].x-viewport[0].x,viewport.h=viewport[1].y-viewport[0].y,updateViewportMeta()}function storeFunctions(){var a=[];[].forEach.call(funcInputs.querySelectorAll("textarea"),function(b){0!==b.value.trim().length&&a.push({func:b.value,color:b.style.borderColor})}),localStorage.setItem("functions",JSON.stringify(a))}function updateCanvasSize(){var a=canvas.getBoundingClientRect();canvas.width=a.width,canvas.height=a.height,updateViewportMeta(),drawAll()}function updateFunctions(){functions=[],[].forEach.call(funcInputs.querySelectorAll("textarea"),function(a){var b=handleFunctionInput(a);b!==!1&&functions.push(b)}),drawAll()}function updateViewportMeta(){offset={x:viewport[0].x-viewport.w,y:viewport[0].y-viewport.h},scale={x:viewport.w/canvas.width,y:viewport.h/canvas.height}}var canvas=document.getElementById("canvas"),context=canvas.getContext("2d"),functions=[],graphInputs=document.querySelector("#graph .inputs"),funcInputs=document.querySelector("#functions .inputs"),viewport,scale,offset,colors=["#662d8f","#00adee","#ec038a","#8bc543","#f69322","#ed1d24","#0054a4","#007137","#ed1659"];setInterval(detectGraphSizeChange,2e3),funcInputs.addEventListener("change",function(a){"TEXTAREA"===a.target.tagName&&(updateFunctions(),storeFunctions())}),document.addEventListener("click",function(a){"createInput"===a.target.name&&createInput()}),graphInputs.addEventListener("change",function(a){readViewportSize(),drawAll()}),fetchFunctions(),readViewportSize(),updateCanvasSize(),updateFunctions(),drawAll();</script></body></html>
