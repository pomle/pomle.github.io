<html class="classic"><head> <title>grafit</title> <meta property="og:title" content="grafit - draw graphs with javascript"/> <meta property="og:description" content="No bullshit. Just JavaScript functions turned into shapes."/> <meta property="og:image" content="http://i.imgur.com/jCmtJsz.png"/> <style type="text/css">body{margin:0}.interface{display:flex;height:100%}#functions{border-right:solid 1px rgba(0,0,0,.2);flex:0 0 auto}#functions textarea{border-style:solid;border-width:1px 0 0 6px;display:block;font-family:monospace;height:5em;width:20em}#functions textarea.error{background-color:rgba(255,0,0,.2)!important}#graph{flex:1 1 auto;position:relative}#graph canvas{height:100%;width:100%}#graph input{background-color:transparent;border-radius:.5em;border:0;font-family:monospace;margin:.2em;opacity:.2;padding:.3em;position:absolute;text-align:center;width:4em}#graph:hover input{background-color:rgba(255,255,255,.8);opacity:1}#graph input[name=x1]{left:0;top:50%;text-align:left}#graph input[name=x2]{top:50%;right:0;text-align:right}#graph input[name=y1]{left:50%;top:0;text-align:left}#graph input[name=y2]{bottom:0;left:50%;text-align:left}.dark body{background-color:#191919}.dark #functions textarea{background-color:#191919;color:#0f0}.dark #graph input{color:#fff}.dark #graph:hover input{background-color:rgba(0,0,0,.8)}</style></head><body> <div class="interface"> <section id="functions"> <div class="inputs"> </div><button name="createInput">Add</button> <select name="theme"> <option value="classic">Paper</option> <option value="dark">Coal</option> </select> </section> <section id="graph"> <div class="inputs"> <input type="text" name="x1" value="-10"/> <input type="text" name="x2" value="10"/> <input type="text" name="y1" value="10"/> <input type="text" name="y2" value="-10"/> </div><canvas id="canvas"/> </section> </div><script type="text/javascript">function canvasPoint(t){return{x:(t.x+-viewport[0].x)/scale.x,y:(t.y+-viewport[0].y)/scale.y}}function createInput(){void 0===colors.counter&&(colors.counter=0);var t=document.createElement("textarea"),e=colors[colors.counter++%colors.length];return t.style.borderColor=e,funcInputs.appendChild(t),t}function detectGraphSizeChange(){var t=canvas.getBoundingClientRect();(canvas.lastW!==t.width||canvas.lastH!==t.height)&&updateCanvasSize()}function drawAll(){context.clearRect(0,0,canvas.width,canvas.height),drawGrid();for(var t=0,e=functions.length;t!==e;++t)functions[t]&&drawFunction(functions[t])}function drawFunction(t){for(var e=[],n=viewport[0].x;n<=viewport[1].x;)e.push({x:n,y:t(n)}),n+=scale.x;context.beginPath();var a=canvasPoint(e[0]);context.moveTo(a.x,a.y);for(var o=1,r=e.length;r>o;++o){var a=canvasPoint(e[o]);context.lineTo(a.x,a.y)}context.strokeStyle=t.color,context.stroke(),context.closePath()}function drawGrid(){var t;context.beginPath(),t=canvasPoint({x:viewport[0].x,y:0}),context.moveTo(t.x,t.y),t=canvasPoint({x:viewport[1].x,y:0}),context.lineTo(t.x,t.y),t=canvasPoint({x:0,y:viewport[0].y}),context.moveTo(t.x,t.y),t=canvasPoint({x:0,y:viewport[1].y}),context.lineTo(t.x,t.y),context.strokeStyle="#1e9dcc",context.stroke(),context.closePath()}function fetchFunctions(){try{var t=localStorage.getItem("functions"),e=JSON.parse(t)}catch(n){console.error(n)}Array.isArray(e)&&0!==e.length||(e=[{func:"function (x){\n return Math.sin(x) * 2;\n}\n",color:colors[0]}]);for(var a=0,o=e.length;a!==o;++a){var r=createInput();r.value=e[a].func,r.style.borderColor=e[a].color,handleFunctionInput(r)}}function handleFunctionInput(t){var e=t.value.trim();if(t.classList.remove("error"),0===e.length)return!1;try{return func=parseFunction(e),func.color=t.style.borderColor,func}catch(n){console.error(n),t.classList.add("error")}return func}function parseFunction(text){for(var wrappers=[{head:"func=",tail:""},{head:"func=function(x){",tail:";}"}],evaluate,func,error,i=0,l=wrappers.length;i!==l;++i){evaluate=wrappers[i].head+text+wrappers[i].tail;try{if(eval(evaluate),"function"==typeof func){if(!isFinite(func(1)))throw new Error("Invalid return value");return func}}catch(e){error=e}}throw error}function readViewportSize(){var t={};[].forEach.call(graphInputs.querySelectorAll("input"),function(e){t[e.name]=parseFloat(e.value)}),viewport=[{x:t.x1,y:t.y1},{x:t.x2,y:t.y2}],viewport.w=viewport[1].x-viewport[0].x,viewport.h=viewport[1].y-viewport[0].y,updateViewportMeta()}function storeFunctions(){var t=[];[].forEach.call(funcInputs.querySelectorAll("textarea"),function(e){0!==e.value.trim().length&&t.push({func:e.value,color:e.style.borderColor})}),localStorage.setItem("functions",JSON.stringify(t))}function updateCanvasSize(){var t=canvas.getBoundingClientRect();canvas.width=t.width,canvas.height=t.height,canvas.lastW=t.width,canvas.lastH=t.height,updateViewportMeta(),drawAll()}function updateFunctions(){functions=[],[].forEach.call(funcInputs.querySelectorAll("textarea"),function(t){var e=handleFunctionInput(t);e!==!1&&functions.push(e)}),drawAll()}function updateViewportMeta(){offset={x:viewport[0].x-viewport.w,y:viewport[0].y-viewport.h},scale={x:viewport.w/canvas.width,y:viewport.h/canvas.height}}var canvas=document.getElementById("canvas"),context=canvas.getContext("2d"),functions=[],graphInputs=document.querySelector("#graph .inputs"),funcInputs=document.querySelector("#functions .inputs"),viewport,scale,offset,colors=["#00adee","#ec038a","#662d8f","#8bc543","#f69322","#ed1d24","#0054a4","#007137","#ed1659"];setInterval(detectGraphSizeChange,2e3),funcInputs.addEventListener("change",function(t){"TEXTAREA"===t.target.tagName?(updateFunctions(),storeFunctions()):"theme"===t.target.name&&console.log(t.target)}),function(){var t=document.querySelector("select[name=theme]");t.addEventListener("change",function(t){var e=t.target,n=document.querySelector("html");[].forEach.call(e,function(t){n.classList.remove(t.value)}),n.classList.add(e.value),localStorage.setItem("theme",e.value)});var e=localStorage.getItem("theme");e&&(t.value=e,t.dispatchEvent(new Event("change")))}(),document.addEventListener("click",function(t){"createInput"===t.target.name&&createInput()}),graphInputs.addEventListener("change",function(t){readViewportSize(),drawAll()}),fetchFunctions(),readViewportSize(),updateCanvasSize(),updateFunctions(),drawAll();</script></body></html>
