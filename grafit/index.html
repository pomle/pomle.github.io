<html><head><title>grafit</title><meta property=og:title content="grafit - draw graphs with javascript"><meta property=og:description content="No bullshit. Just JavaScript functions turned into shapes."><meta property=og:image content=http://i.imgur.com/jCmtJsz.png><style type=text/css>body{margin:0}.interface{display:flex}#functions{border-right:solid 1px rgba(0,0,0,.2);flex:0 0}#functions textarea{border-top-width:2px;display:block;font-family:monospace;height:5em;width:20em}#functions textarea.error{background-color:rgba(255,0,0,.2)}#graph{flex-grow:1;position:relative}#graph canvas{height:100%;width:100%}#graph input{background-color:transparent;border-radius:.5em;border:0;font-family:monospace;margin:.2em;opacity:.2;padding:.3em;position:absolute;text-align:center;width:4em}#graph:hover input{background-color:rgba(255,255,255,.8);opacity:1}#graph input[name=x1]{left:0;top:50%;text-align:left}#graph input[name=x2]{top:50%;right:0;text-align:right}#graph input[name=y1]{left:50%;top:0;text-align:left}#graph input[name=y2]{bottom:0;left:50%;text-align:left}</style><body><div class=interface><section id=functions><div class=inputs></div><button name=createInput>+</button></section><section id=graph><div class=inputs><input name=x1 value=-10> <input name=x2 value=10> <input name=y1 value=10> <input name=y2 value=-10></div><canvas id=canvas></section></div><script>function canvasPoint(t){return{x:(t.x+-viewport[0].x)/scale.x,y:(t.y+-viewport[0].y)/scale.y}}function createInput(){void 0===colors.counter&&(colors.counter=0);var t=document.createElement("textarea"),e=colors[colors.counter++%colors.length];return t.style.borderColor=e,funcInputs.appendChild(t),t}function detectGraphSizeChange(){var t=canvas.getBoundingClientRect();(canvas.lastW!==t.width||canvas.lastH!==t.height)&&updateCanvasSize()}function drawAll(){context.clearRect(0,0,canvas.width,canvas.height),drawGrid();for(var t=0,e=functions.length;t!==e;++t)functions[t]&&drawFunction(functions[t])}function drawFunction(t){for(var e=[],n=viewport[0].x;n<=viewport[1].x;)e.push({x:n,y:t(n)}),n+=scale.x;context.beginPath();var o=canvasPoint(e[0]);context.moveTo(o.x,o.y);for(var a=1,r=e.length;r>a;++a){var o=canvasPoint(e[a]);context.lineTo(o.x,o.y)}context.strokeStyle=t.color,context.stroke(),context.closePath()}function drawGrid(){var t;context.beginPath(),t=canvasPoint({x:viewport[0].x,y:0}),context.moveTo(t.x,t.y),t=canvasPoint({x:viewport[1].x,y:0}),context.lineTo(t.x,t.y),t=canvasPoint({x:0,y:viewport[0].y}),context.moveTo(t.x,t.y),t=canvasPoint({x:0,y:viewport[1].y}),context.lineTo(t.x,t.y),context.strokeStyle="#1e9dcc",context.stroke(),context.closePath()}function fetchFunctions(){try{var t=localStorage.getItem("functions"),e=JSON.parse(t)}catch(n){console.error(n)}Array.isArray(e)&&0!==e.length||(e=[{func:"function (x){\n return Math.sin(x) * 2;\n}\n",color:colors[0]}]);for(var o=0,a=e.length;o!==a;++o){var r=createInput();r.value=e[o].func,r.style.borderColor=e[o].color,handleFunctionInput(r)}}function handleFunctionInput(t){var e=t.value.trim();if(t.classList.remove("error"),0===e.length)return!1;try{return func=parseFunction(e),func.color=t.style.borderColor,func}catch(n){t.classList.add("error")}return func}function parseFunction(text){for(var wrappers=[{head:"func=",tail:""},{head:"func=function(x){",tail:";}"}],evaluate,func,i=0,l=wrappers.length;i!==l;++i){evaluate=wrappers[i].head+text+wrappers[i].tail;try{if(eval(evaluate),"function"==typeof func)return func}catch(error){}}throw error}function readViewportSize(){var t={};[].forEach.call(graphInputs.querySelectorAll("input"),function(e){t[e.name]=parseFloat(e.value)}),viewport=[{x:t.x1,y:t.y1},{x:t.x2,y:t.y2}],viewport.w=viewport[1].x-viewport[0].x,viewport.h=viewport[1].y-viewport[0].y,updateViewportMeta()}function storeFunctions(){var t=[];[].forEach.call(funcInputs.querySelectorAll("textarea"),function(e){0!==e.value.trim().length&&t.push({func:e.value,color:e.style.borderColor})}),localStorage.setItem("functions",JSON.stringify(t))}function updateCanvasSize(){var t=canvas.getBoundingClientRect();canvas.width=t.width,canvas.height=t.height,canvas.lastW=t.width,canvas.lastH=t.height,updateViewportMeta(),drawAll()}function updateFunctions(){functions=[],[].forEach.call(funcInputs.querySelectorAll("textarea"),function(t){var e=handleFunctionInput(t);e!==!1&&functions.push(e)}),drawAll()}function updateViewportMeta(){offset={x:viewport[0].x-viewport.w,y:viewport[0].y-viewport.h},scale={x:viewport.w/canvas.width,y:viewport.h/canvas.height}}var canvas=document.getElementById("canvas"),context=canvas.getContext("2d"),functions=[],graphInputs=document.querySelector("#graph .inputs"),funcInputs=document.querySelector("#functions .inputs"),viewport,scale,offset,colors=["#662d8f","#00adee","#ec038a","#8bc543","#f69322","#ed1d24","#0054a4","#007137","#ed1659"];setInterval(detectGraphSizeChange,2e3),funcInputs.addEventListener("change",function(t){"TEXTAREA"===t.target.tagName&&(updateFunctions(),storeFunctions())}),document.addEventListener("click",function(t){"createInput"===t.target.name&&createInput()}),graphInputs.addEventListener("change",function(t){readViewportSize(),drawAll()}),fetchFunctions(),readViewportSize(),updateCanvasSize(),updateFunctions(),drawAll();</script>
